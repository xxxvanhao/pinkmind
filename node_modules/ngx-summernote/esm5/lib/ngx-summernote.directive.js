/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpClient } from '@angular/common/http';
import { Directive, ElementRef, EventEmitter, forwardRef, Input, NgZone, Output, } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { of, throwError } from 'rxjs';
import { catchError, map } from 'rxjs/operators';
var NgxSummernoteDirective = /** @class */ (function () {
    function NgxSummernoteDirective(el, zone, http) {
        var _this = this;
        this.zone = zone;
        this.http = http;
        // summernoteModel directive as output: update model if editor contentChanged
        this.summernoteModelChange = new EventEmitter();
        this.imageUpload = new EventEmitter();
        // summernoteInit directive as output: send manual editor initialization
        this.summernoteInit = new EventEmitter();
        this.blur = new EventEmitter();
        this._options = {
            immediateAngularModelUpdate: false,
            angularIgnoreAttrs: null,
            placeholder: '',
            tabsize: 2,
            height: 100,
            uploadImagePath: '',
            toolbar: [
                // [groupName, [list of button]]
                ['misc', ['codeview', 'undo', 'redo', 'codeBlock']],
                // ['style', ['bold', 'italic', 'underline', 'clear']],
                ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
                ['fontsize', ['fontname', 'fontsize', 'color']],
                ['para', ['style0', 'ul', 'ol', 'paragraph', 'height']],
                ['insert', ['table', 'picture', 'link', 'video', 'hr']],
            ],
            fontNames: ['Helvetica', 'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 'Roboto', 'Times'],
            callbacks: {
                onImageUpload: function (files) { return _this.uploadImage(files); }
            },
            buttons: {
                codeBlock: this.codeBlockButton()
            }
        };
        this.SPECIAL_TAGS = ['img', 'button', 'input', 'a'];
        this.INNER_HTML_ATTR = 'innerHTML';
        this._oldModel = null;
        // Begin ControlValueAccesor methods.
        this.onChange = function (_) { };
        this.onTouched = function () { };
        /** @type {?} */
        var element = el.nativeElement;
        // check if the element is a special tag
        if (this.SPECIAL_TAGS.indexOf(element.tagName.toLowerCase()) !== -1) {
            this._hasSpecialTag = true;
        }
        // jquery wrap and store element
        this._$element = ((/** @type {?} */ ($(element))));
        this.zone = zone;
    }
    Object.defineProperty(NgxSummernoteDirective.prototype, "ngxSummernote", {
        set: /**
         * @param {?} options
         * @return {?}
         */
        function (options) {
            if (options.buttons) {
                Object.assign(options.buttons, this._options.buttons);
            }
            this._options = Object.assign(this._options, options);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgxSummernoteDirective.prototype, "summernoteModel", {
        // summernoteModel directive as input: store initial editor content
        set: 
        // summernoteModel directive as input: store initial editor content
        /**
         * @param {?} content
         * @return {?}
         */
        function (content) {
            this.updateEditor(content);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    NgxSummernoteDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this._options.toolbar;
        // check if output summernoteInit is present. Maybe observers is private and
        // should not be used?? TODO how to better test that an output directive is present.
        if (!this.summernoteInit.observers.length) {
            this.createEditor();
        }
        else {
            // TODO not sure it works now...
            this.generateManualController();
        }
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    NgxSummernoteDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (this._editorInitialized && changes) {
            if (changes.ngxSummernoteDisabled && !changes.ngxSummernoteDisabled.firstChange &&
                changes.ngxSummernoteDisabled.currentValue !== changes.ngxSummernoteDisabled.previousValue) {
                if (changes.ngxSummernoteDisabled.currentValue) {
                    this._$element.summernote('disable');
                }
                else {
                    this._$element.summernote('enable');
                }
            }
        }
    };
    /**
     * @return {?}
     */
    NgxSummernoteDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroyEditor();
    };
    // Form model content changed.
    // Form model content changed.
    /**
     * @param {?} content
     * @return {?}
     */
    NgxSummernoteDirective.prototype.writeValue = 
    // Form model content changed.
    /**
     * @param {?} content
     * @return {?}
     */
    function (content) {
        this.updateEditor(content);
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    NgxSummernoteDirective.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) { this.onChange = fn; };
    /**
     * @param {?} fn
     * @return {?}
     */
    NgxSummernoteDirective.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) { this.onTouched = fn; };
    // Update editor with model contents.
    // Update editor with model contents.
    /**
     * @private
     * @param {?} content
     * @return {?}
     */
    NgxSummernoteDirective.prototype.updateEditor = 
    // Update editor with model contents.
    /**
     * @private
     * @param {?} content
     * @return {?}
     */
    function (content) {
        if (JSON.stringify(this._oldModel) === JSON.stringify(content)) {
            return;
        }
        this._oldModel = content;
        this._$element.html(content);
        if (this._editorInitialized) {
            this._$element.summernote('code', content);
        }
        else {
            this._$element.html(content);
        }
    };
    // update model if editor contentChanged
    // update model if editor contentChanged
    /**
     * @private
     * @param {?=} content
     * @return {?}
     */
    NgxSummernoteDirective.prototype.updateModel = 
    // update model if editor contentChanged
    /**
     * @private
     * @param {?=} content
     * @return {?}
     */
    function (content) {
        var _this = this;
        // console.log("update model", content)
        this.zone.run(function () {
            /** @type {?} */
            var modelContent = null;
            if (_this._hasSpecialTag) {
                /** @type {?} */
                var attributeNodes = _this._$element[0].attributes;
                /** @type {?} */
                var attrs = {};
                for (var i = 0; i < attributeNodes.length; i++) {
                    /** @type {?} */
                    var attrName = attributeNodes[i].name;
                    if (_this._options.angularIgnoreAttrs && _this._options.angularIgnoreAttrs.indexOf(attrName) !== -1) {
                        continue;
                    }
                    attrs[attrName] = attributeNodes[i].value;
                }
                if (_this._$element[0].innerHTML) {
                    attrs[_this.INNER_HTML_ATTR] = _this._$element[0].innerHTML;
                }
                modelContent = attrs;
            }
            else {
                /** @type {?} */
                var returnedHtml = content || '';
                if (typeof returnedHtml === 'string') {
                    modelContent = returnedHtml;
                }
            }
            _this._oldModel = modelContent;
            // Update summernoteModel
            _this.summernoteModelChange.emit(modelContent);
            // Update form model.
            _this.onChange(content);
        });
    };
    /**
     * @private
     * @return {?}
     */
    NgxSummernoteDirective.prototype.initListeners = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var self = this;
        if (!this._$element) {
            return;
        }
        this._$element.on('summernote.init', function () {
            setTimeout(function () {
                self.updateModel();
            }, 0);
        });
        this._$element.on('summernote.change', function (event, contents, $editable) {
            setTimeout(function () {
                self.updateModel(contents);
            }, 0);
        });
        this._$element.on('summernote.blur', function () {
            setTimeout(function () {
                self.onTouched();
                self.blur.emit();
            }, 0);
        });
        if (this._options.immediateAngularModelUpdate) {
            this._editor.on('keyup', function () {
                setTimeout(function () {
                    self.updateModel();
                }, 0);
            });
        }
    };
    /**
     * @private
     * @return {?}
     */
    NgxSummernoteDirective.prototype.createEditor = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this._editorInitialized) {
            return;
        }
        this.setContent(true);
        // this.initListeners(); // issue #31 
        // init editor
        this.zone.runOutsideAngular(function () {
            _this._editor = _this._$element.summernote(_this._options).data('summernote').$note;
            _this.initListeners(); // issue #31
            if (_this.ngxSummernoteDisabled) {
                _this._$element.summernote('disable');
            }
        });
        this._editorInitialized = true;
    };
    /**
     * @private
     * @return {?}
     */
    NgxSummernoteDirective.prototype.setHtml = /**
     * @private
     * @return {?}
     */
    function () {
        this._$element.summernote('code', this._model || '', true);
    };
    /**
     * @private
     * @param {?=} firstTime
     * @return {?}
     */
    NgxSummernoteDirective.prototype.setContent = /**
     * @private
     * @param {?=} firstTime
     * @return {?}
     */
    function (firstTime) {
        if (firstTime === void 0) { firstTime = false; }
        // console.log("set content", firstTime, this._oldModel, this._model)
        /** @type {?} */
        var self = this;
        // Set initial content
        if (this._model || this._model === '') {
            this._oldModel = this._model;
            if (this._hasSpecialTag) {
                /** @type {?} */
                var tags = this._model;
                // add tags on element
                if (tags) {
                    for (var attr in tags) {
                        if (tags.hasOwnProperty(attr) && attr !== this.INNER_HTML_ATTR) {
                            this._$element.attr(attr, tags[attr]);
                        }
                    }
                    if (tags.hasOwnProperty(this.INNER_HTML_ATTR)) {
                        this._$element[0].innerHTML = tags[this.INNER_HTML_ATTR];
                    }
                }
            }
            else {
                self.setHtml();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    NgxSummernoteDirective.prototype.destroyEditor = /**
     * @private
     * @return {?}
     */
    function () {
        if (this._editorInitialized) {
            this._editor.off('keyup');
            this._$element.summernote('destroy'); // TODO not sure it works now...
            this._editorInitialized = false;
        }
    };
    /**
     * @private
     * @return {?}
     */
    NgxSummernoteDirective.prototype.getEditor = /**
     * @private
     * @return {?}
     */
    function () {
        if (this._$element) {
            return this._$element.summernote.bind(this._$element);
        }
        return null;
    };
    // send manual editor initialization
    // TODO not sure it works now...
    // send manual editor initialization
    // TODO not sure it works now...
    /**
     * @private
     * @return {?}
     */
    NgxSummernoteDirective.prototype.generateManualController = 
    // send manual editor initialization
    // TODO not sure it works now...
    /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var controls = {
            initialize: this.createEditor.bind(this),
            destroy: this.destroyEditor.bind(this),
            getEditor: this.getEditor.bind(this),
        };
        this.summernoteInit.emit(controls);
    };
    /**
     * @private
     * @param {?} files
     * @return {?}
     */
    NgxSummernoteDirective.prototype.uploadImage = /**
     * @private
     * @param {?} files
     * @return {?}
     */
    function (files) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var data;
            var _this = this;
            return tslib_1.__generator(this, function (_a) {
                data = new FormData();
                this.imageUpload.emit({ uploading: true });
                data.append('image', files[0]);
                if (this._options.uploadImagePath) {
                    this.http.post(this._options.uploadImagePath, data)
                        .pipe(map(function (response) { return response && typeof response.path === 'string' && response.path; }), catchError(function (e) {
                        throwError('An error occured while uploading' + e);
                        return of('');
                    }))
                        .subscribe(function (dataIn) {
                        if (dataIn) {
                            _this._$element.summernote('insertImage', dataIn);
                            _this.imageUpload.emit({ uploading: false });
                        }
                        else {
                            _this.insertFromDataURL(files);
                        }
                    }, function (e) {
                        _this.insertFromDataURL(files);
                    });
                }
                else {
                    this.insertFromDataURL(files);
                }
                return [2 /*return*/];
            });
        });
    };
    /**
     * @param {?} files
     * @return {?}
     */
    NgxSummernoteDirective.prototype.insertFromDataURL = /**
     * @param {?} files
     * @return {?}
     */
    function (files) {
        var _this = this;
        /** @type {?} */
        var reader = new FileReader();
        reader.readAsDataURL(files[0]);
        reader.onload = function () {
            _this._$element.summernote('insertImage', reader.result);
            _this.imageUpload.emit({ uploading: false, encoding: 'base64' });
        };
        reader.onerror = function (error) { return console.error(error); };
    };
    /**
     * @private
     * @return {?}
     */
    NgxSummernoteDirective.prototype.codeBlockButton = /**
     * @private
     * @return {?}
     */
    function () {
        return function (context) {
            /** @type {?} */
            var ui = $.summernote.ui;
            // create button
            /** @type {?} */
            var button = ui.button({
                contents: 'Code block',
                tooltip: 'Add raw code',
                click: function () {
                    /** @type {?} */
                    var selectedText = null;
                    // The below code will copy the selected block and add it into our code=block
                    if (window.getSelection) {
                        selectedText = window.getSelection().toString().replace(/^\s+|\s+$/g, '');
                    }
                    /** @type {?} */
                    var codeText = selectedText ? selectedText : "Place your code here.";
                    /** @type {?} */
                    var codeBlock = "<pre class=\"code-block\" style=\"font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; padding: 14px 12px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(250, 251, 253); border: 1px solid rgb(234, 236, 240); border-radius: 4px; color: #60a0b0\"><span style=\"white-space: pre-wrap;\">" + codeText + "</span></pre>";
                    context.invoke('editor.pasteHTML', codeBlock);
                }
            });
            return button.render(); // return button as jquery object
        };
    };
    NgxSummernoteDirective.decorators = [
        { type: Directive, args: [{
                    // tslint:disable-next-line:directive-selector
                    selector: '[ngxSummernote]',
                    providers: [{
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(function () { return NgxSummernoteDirective; }),
                            multi: true
                        }]
                },] },
    ];
    /** @nocollapse */
    NgxSummernoteDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: NgZone },
        { type: HttpClient }
    ]; };
    NgxSummernoteDirective.propDecorators = {
        ngxSummernote: [{ type: Input }],
        summernoteModel: [{ type: Input }],
        summernoteModelChange: [{ type: Output }],
        imageUpload: [{ type: Output }],
        summernoteInit: [{ type: Output }],
        blur: [{ type: Output }],
        ngxSummernoteDisabled: [{ type: Input }]
    };
    return NgxSummernoteDirective;
}());
export { NgxSummernoteDirective };
if (false) {
    /** @type {?} */
    NgxSummernoteDirective.prototype.summernoteModelChange;
    /** @type {?} */
    NgxSummernoteDirective.prototype.imageUpload;
    /** @type {?} */
    NgxSummernoteDirective.prototype.summernoteInit;
    /** @type {?} */
    NgxSummernoteDirective.prototype.blur;
    /** @type {?} */
    NgxSummernoteDirective.prototype.ngxSummernoteDisabled;
    /**
     * @type {?}
     * @private
     */
    NgxSummernoteDirective.prototype._options;
    /**
     * @type {?}
     * @private
     */
    NgxSummernoteDirective.prototype.SPECIAL_TAGS;
    /**
     * @type {?}
     * @private
     */
    NgxSummernoteDirective.prototype.INNER_HTML_ATTR;
    /**
     * @type {?}
     * @private
     */
    NgxSummernoteDirective.prototype._hasSpecialTag;
    /**
     * @type {?}
     * @private
     */
    NgxSummernoteDirective.prototype._$element;
    /**
     * @type {?}
     * @private
     */
    NgxSummernoteDirective.prototype._editor;
    /**
     * @type {?}
     * @private
     */
    NgxSummernoteDirective.prototype._model;
    /**
     * @type {?}
     * @private
     */
    NgxSummernoteDirective.prototype._oldModel;
    /**
     * @type {?}
     * @private
     */
    NgxSummernoteDirective.prototype._editorInitialized;
    /** @type {?} */
    NgxSummernoteDirective.prototype.onChange;
    /** @type {?} */
    NgxSummernoteDirective.prototype.onTouched;
    /**
     * @type {?}
     * @private
     */
    NgxSummernoteDirective.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    NgxSummernoteDirective.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXN1bW1lcm5vdGUuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXN1bW1lcm5vdGUvIiwic291cmNlcyI6WyJsaWIvbmd4LXN1bW1lcm5vdGUuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFDSCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixVQUFVLEVBQ1YsS0FBSyxFQUNMLE1BQU0sRUFJTixNQUFNLEdBQ1QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUF3QixpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFJakQ7SUFrRUksZ0NBQVksRUFBYyxFQUFVLElBQVksRUFBVSxJQUFnQjtRQUExRSxpQkFXQztRQVhtQyxTQUFJLEdBQUosSUFBSSxDQUFRO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBWTs7UUE1Q2hFLDBCQUFxQixHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ25FLGdCQUFXLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7O1FBR3pELG1CQUFjLEdBQXlCLElBQUksWUFBWSxFQUFVLENBQUM7UUFFbEUsU0FBSSxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBSXBELGFBQVEsR0FBUTtZQUNwQiwyQkFBMkIsRUFBRSxLQUFLO1lBQ2xDLGtCQUFrQixFQUFFLElBQUk7WUFDeEIsV0FBVyxFQUFFLEVBQUU7WUFDZixPQUFPLEVBQUUsQ0FBQztZQUNWLE1BQU0sRUFBRSxHQUFHO1lBQ1gsZUFBZSxFQUFFLEVBQUU7WUFDbkIsT0FBTyxFQUFFO2dCQUNMLGdDQUFnQztnQkFDaEMsQ0FBQyxN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QyxjQUFNLE9BQUEsc0JBQXNCLEVBQXRCLENBQXNCLENBQUM7NEJBQ3JELEtBQUssRUFBRSxJQUFJO3lCQUNkLENBQUM7aUJBQ0w7Ozs7Z0JBeEJHLFVBQVU7Z0JBSVYsTUFBTTtnQkFQRCxVQUFVOzs7Z0NBNkJkLEtBQUs7a0NBT0wsS0FBSzt3Q0FLTCxNQUFNOzhCQUNOLE1BQU07aUNBR04sTUFBTTt1QkFFTixNQUFNO3dDQUVOLEtBQUs7O0lBNlRWLDZCQUFDO0NBQUEsQUEzVkQsSUEyVkM7U0FsVlksc0JBQXNCOzs7SUFhL0IsdURBQTZFOztJQUM3RSw2Q0FBbUU7O0lBR25FLGdEQUE0RTs7SUFFNUUsc0NBQTREOztJQUU1RCx1REFBd0M7Ozs7O0lBRXhDLDBDQXVCRTs7Ozs7SUFFRiw4Q0FBaUU7Ozs7O0lBQ2pFLGlEQUFzQzs7Ozs7SUFDdEMsZ0RBQWdDOzs7OztJQUNoQywyQ0FBdUI7Ozs7O0lBQ3ZCLHlDQUFxQjs7Ozs7SUFDckIsd0NBQXVCOzs7OztJQUN2QiwyQ0FBaUM7Ozs7O0lBQ2pDLG9EQUFvQzs7SUE2Q3BDLDBDQUFzQjs7SUFDdEIsMkNBQXNCOzs7OztJQTVDTSxzQ0FBb0I7Ozs7O0lBQUUsc0NBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7XG4gICAgRGlyZWN0aXZlLFxuICAgIEVsZW1lbnRSZWYsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIGZvcndhcmRSZWYsXG4gICAgSW5wdXQsXG4gICAgTmdab25lLFxuICAgIE9uQ2hhbmdlcyxcbiAgICBPbkRlc3Ryb3ksXG4gICAgT25Jbml0LFxuICAgIE91dHB1dCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBvZiwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5kZWNsYXJlIHZhciAkO1xuXG5ARGlyZWN0aXZlKHtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6ZGlyZWN0aXZlLXNlbGVjdG9yXG4gICAgc2VsZWN0b3I6ICdbbmd4U3VtbWVybm90ZV0nLFxuICAgIHByb3ZpZGVyczogW3tcbiAgICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IE5neFN1bW1lcm5vdGVEaXJlY3RpdmUpLFxuICAgICAgICBtdWx0aTogdHJ1ZVxuICAgIH1dXG59KVxuZXhwb3J0IGNsYXNzIE5neFN1bW1lcm5vdGVEaXJlY3RpdmUgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcyB7XG4gICAgQElucHV0KCkgc2V0IG5neFN1bW1lcm5vdGUob3B0aW9uczogYW55KSB7XG4gICAgICAgIGlmIChvcHRpb25zLmJ1dHRvbnMpIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ob3B0aW9ucy5idXR0b25zLCB0aGlzLl9vcHRpb25zLmJ1dHRvbnMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSBPYmplY3QuYXNzaWduKHRoaXMuX29wdGlvbnMsIG9wdGlvbnMpO1xuICAgIH1cbiAgICAvLyBzdW1tZXJub3RlTW9kZWwgZGlyZWN0aXZlIGFzIGlucHV0OiBzdG9yZSBpbml0aWFsIGVkaXRvciBjb250ZW50XG4gICAgQElucHV0KCkgc2V0IHN1bW1lcm5vdGVNb2RlbChjb250ZW50OiBhbnkpIHtcbiAgICAgICAgdGhpcy51cGRhdGVFZGl0b3IoY29udGVudCk7XG4gICAgfVxuXG4gICAgLy8gc3VtbWVybm90ZU1vZGVsIGRpcmVjdGl2ZSBhcyBvdXRwdXQ6IHVwZGF0ZSBtb2RlbCBpZiBlZGl0b3IgY29udGVudENoYW5nZWRcbiAgICBAT3V0cHV0KCkgc3VtbWVybm90ZU1vZGVsQ2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIEBPdXRwdXQoKSBpbWFnZVVwbG9hZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIC8vIHN1bW1lcm5vdGVJbml0IGRpcmVjdGl2ZSBhcyBvdXRwdXQ6IHNlbmQgbWFudWFsIGVkaXRvciBpbml0aWFsaXphdGlvblxuICAgIEBPdXRwdXQoKSBzdW1tZXJub3RlSW5pdDogRXZlbnRFbWl0dGVyPE9iamVjdD4gPSBuZXcgRXZlbnRFbWl0dGVyPE9iamVjdD4oKTtcblxuICAgIEBPdXRwdXQoKSBibHVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgQElucHV0KCkgbmd4U3VtbWVybm90ZURpc2FibGVkOiBib29sZWFuO1xuXG4gICAgcHJpdmF0ZSBfb3B0aW9uczogYW55ID0ge1xuICAgICAgICBpbW1lZGlhdGVBbmd1bGFyTW9kZWxVcGRhdGU6IGZhbHNlLFxuICAgICAgICBhbmd1bGFySWdub3JlQXR0cnM6IG51bGwsXG4gICAgICAgIHBsYWNlaG9sZGVyOiAnJyxcbiAgICAgICAgdGFic2l6ZTogMixcbiAgICAgICAgaGVpZ2h0OiAxMDAsXG4gICAgICAgIHVwbG9hZEltYWdlUGF0aDogJycsXG4gICAgICAgIHRvb2xiYXI6IFtcbiAgICAgICAgICAgIC8vIFtncm91cE5hbWUsIFtsaXN0IG9mIGJ1dHRvbl1dXG4gICAgICAgICAgICBbJ21pc2MnLCBbJ2NvZGV2aWV3JywgJ3VuZG8nLCAncmVkbycsICdjb2RlQmxvY2snXV0sXG4gICAgICAgICAgICAvLyBbJ3N0eWxlJywgWydib2xkJywgJ2l0YWxpYycsICd1bmRlcmxpbmUnLCAnY2xlYXInXV0sXG4gICAgICAgICAgICBbJ2ZvbnQnLCBbJ2JvbGQnLCAnaXRhbGljJywgJ3VuZGVybGluZScsICdzdHJpa2V0aHJvdWdoJywgJ3N1cGVyc2NyaXB0JywgJ3N1YnNjcmlwdCcsICdjbGVhciddXSxcbiAgICAgICAgICAgIFsnZm9udHNpemUnLCBbJ2ZvbnRuYW1lJywgJ2ZvbnRzaXplJywgJ2NvbG9yJ11dLFxuICAgICAgICAgICAgWydwYXJhJywgWydzdHlsZTAnLCAndWwnLCAnb2wnLCAncGFyYWdyYXBoJywgJ2hlaWdodCddXSxcbiAgICAgICAgICAgIFsnaW5zZXJ0JywgWyd0YWJsZScsICdwaWN0dXJlJywgJ2xpbmsnLCAndmlkZW8nLCAnaHInXV0sXG4gICAgICAgIF0sXG4gICAgICAgIGZvbnROYW1lczogWydIZWx2ZXRpY2EnLCAnQXJpYWwnLCAnQXJpYWwgQmxhY2snLCAnQ29taWMgU2FucyBNUycsICdDb3VyaWVyIE5ldycsICdSb2JvdG8nLCAnVGltZXMnXSxcbiAgICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgICAgICBvbkltYWdlVXBsb2FkOiAoZmlsZXMpID0+IHRoaXMudXBsb2FkSW1hZ2UoZmlsZXMpXG4gICAgICAgIH0sXG4gICAgICAgIGJ1dHRvbnM6IHtcbiAgICAgICAgICAgIGNvZGVCbG9jazogdGhpcy5jb2RlQmxvY2tCdXR0b24oKVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgU1BFQ0lBTF9UQUdTOiBzdHJpbmdbXSA9IFsnaW1nJywgJ2J1dHRvbicsICdpbnB1dCcsICdhJ107XG4gICAgcHJpdmF0ZSBJTk5FUl9IVE1MX0FUVFIgPSAnaW5uZXJIVE1MJztcbiAgICBwcml2YXRlIF9oYXNTcGVjaWFsVGFnOiBib29sZWFuO1xuICAgIHByaXZhdGUgXyRlbGVtZW50OiBhbnk7IC8vIGpxdWVyeSB3cmFwcGVkIGVsZW1lbnRcbiAgICBwcml2YXRlIF9lZGl0b3I6IGFueTsgLy8gZWRpdG9yIGVsZW1lbnRcbiAgICBwcml2YXRlIF9tb2RlbDogc3RyaW5nO1xuICAgIHByaXZhdGUgX29sZE1vZGVsOiBzdHJpbmcgPSBudWxsO1xuICAgIHByaXZhdGUgX2VkaXRvckluaXRpYWxpemVkOiBib29sZWFuO1xuXG4gICAgY29uc3RydWN0b3IoZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgem9uZTogTmdab25lLCBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHtcbiAgICAgICAgY29uc3QgZWxlbWVudDogYW55ID0gZWwubmF0aXZlRWxlbWVudDtcblxuICAgICAgICAvLyBjaGVjayBpZiB0aGUgZWxlbWVudCBpcyBhIHNwZWNpYWwgdGFnXG4gICAgICAgIGlmICh0aGlzLlNQRUNJQUxfVEFHUy5pbmRleE9mKGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuX2hhc1NwZWNpYWxUYWcgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8ganF1ZXJ5IHdyYXAgYW5kIHN0b3JlIGVsZW1lbnRcbiAgICAgICAgdGhpcy5fJGVsZW1lbnQgPSAoPGFueT4kKGVsZW1lbnQpKTtcbiAgICAgICAgdGhpcy56b25lID0gem9uZTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5fb3B0aW9ucy50b29sYmFyXG4gICAgICAgIC8vIGNoZWNrIGlmIG91dHB1dCBzdW1tZXJub3RlSW5pdCBpcyBwcmVzZW50LiBNYXliZSBvYnNlcnZlcnMgaXMgcHJpdmF0ZSBhbmRcbiAgICAgICAgLy8gc2hvdWxkIG5vdCBiZSB1c2VkPz8gVE9ETyBob3cgdG8gYmV0dGVyIHRlc3QgdGhhdCBhbiBvdXRwdXQgZGlyZWN0aXZlIGlzIHByZXNlbnQuXG4gICAgICAgIGlmICghdGhpcy5zdW1tZXJub3RlSW5pdC5vYnNlcnZlcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUVkaXRvcigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gVE9ETyBub3Qgc3VyZSBpdCB3b3JrcyBub3cuLi5cbiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVNYW51YWxDb250cm9sbGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzKSB7XG4gICAgICAgIGlmICh0aGlzLl9lZGl0b3JJbml0aWFsaXplZCAmJiBjaGFuZ2VzKSB7XG4gICAgICAgICAgICBpZiAoY2hhbmdlcy5uZ3hTdW1tZXJub3RlRGlzYWJsZWQgJiYgIWNoYW5nZXMubmd4U3VtbWVybm90ZURpc2FibGVkLmZpcnN0Q2hhbmdlICYmXG4gICAgICAgICAgICAgICAgY2hhbmdlcy5uZ3hTdW1tZXJub3RlRGlzYWJsZWQuY3VycmVudFZhbHVlICE9PSBjaGFuZ2VzLm5neFN1bW1lcm5vdGVEaXNhYmxlZC5wcmV2aW91c1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNoYW5nZXMubmd4U3VtbWVybm90ZURpc2FibGVkLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl8kZWxlbWVudC5zdW1tZXJub3RlKCdkaXNhYmxlJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fJGVsZW1lbnQuc3VtbWVybm90ZSgnZW5hYmxlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuZGVzdHJveUVkaXRvcigpO1xuICAgIH1cblxuICAgIC8vIEJlZ2luIENvbnRyb2xWYWx1ZUFjY2Vzb3IgbWV0aG9kcy5cbiAgICBvbkNoYW5nZSA9IChfKSA9PiB7IH07XG4gICAgb25Ub3VjaGVkID0gKCkgPT4geyB9O1xuXG4gICAgLy8gRm9ybSBtb2RlbCBjb250ZW50IGNoYW5nZWQuXG4gICAgd3JpdGVWYWx1ZShjb250ZW50OiBhbnkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy51cGRhdGVFZGl0b3IoY29udGVudCk7XG4gICAgfVxuXG4gICAgcmVnaXN0ZXJPbkNoYW5nZShmbjogKF86IGFueSkgPT4gdm9pZCk6IHZvaWQgeyB0aGlzLm9uQ2hhbmdlID0gZm47IH1cbiAgICByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4gdm9pZCk6IHZvaWQgeyB0aGlzLm9uVG91Y2hlZCA9IGZuOyB9XG5cbiAgICAvLyBVcGRhdGUgZWRpdG9yIHdpdGggbW9kZWwgY29udGVudHMuXG4gICAgcHJpdmF0ZSB1cGRhdGVFZGl0b3IoY29udGVudDogYW55KSB7XG4gICAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh0aGlzLl9vbGRNb2RlbCkgPT09IEpTT04uc3RyaW5naWZ5KGNvbnRlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9vbGRNb2RlbCA9IGNvbnRlbnQ7XG4gICAgICAgIHRoaXMuXyRlbGVtZW50Lmh0bWwoY29udGVudCk7XG5cbiAgICAgICAgaWYgKHRoaXMuX2VkaXRvckluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICB0aGlzLl8kZWxlbWVudC5zdW1tZXJub3RlKCdjb2RlJywgY29udGVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl8kZWxlbWVudC5odG1sKGNvbnRlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gdXBkYXRlIG1vZGVsIGlmIGVkaXRvciBjb250ZW50Q2hhbmdlZFxuICAgIHByaXZhdGUgdXBkYXRlTW9kZWwoY29udGVudD86IGFueSkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInVwZGF0ZSBtb2RlbFwiLCBjb250ZW50KVxuICAgICAgICB0aGlzLnpvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgIGxldCBtb2RlbENvbnRlbnQ6IGFueSA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLl9oYXNTcGVjaWFsVGFnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlTm9kZXMgPSB0aGlzLl8kZWxlbWVudFswXS5hdHRyaWJ1dGVzO1xuICAgICAgICAgICAgICAgIGNvbnN0IGF0dHJzID0ge307XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF0dHJpYnV0ZU5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGF0dHJOYW1lID0gYXR0cmlidXRlTm9kZXNbaV0ubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuYW5ndWxhcklnbm9yZUF0dHJzICYmIHRoaXMuX29wdGlvbnMuYW5ndWxhcklnbm9yZUF0dHJzLmluZGV4T2YoYXR0ck5hbWUpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYXR0cnNbYXR0ck5hbWVdID0gYXR0cmlidXRlTm9kZXNbaV0udmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuXyRlbGVtZW50WzBdLmlubmVySFRNTCkge1xuICAgICAgICAgICAgICAgICAgICBhdHRyc1t0aGlzLklOTkVSX0hUTUxfQVRUUl0gPSB0aGlzLl8kZWxlbWVudFswXS5pbm5lckhUTUw7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbW9kZWxDb250ZW50ID0gYXR0cnM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJldHVybmVkSHRtbDogYW55ID0gY29udGVudCB8fCAnJztcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJldHVybmVkSHRtbCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kZWxDb250ZW50ID0gcmV0dXJuZWRIdG1sO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX29sZE1vZGVsID0gbW9kZWxDb250ZW50O1xuICAgICAgICAgICAgLy8gVXBkYXRlIHN1bW1lcm5vdGVNb2RlbFxuICAgICAgICAgICAgdGhpcy5zdW1tZXJub3RlTW9kZWxDaGFuZ2UuZW1pdChtb2RlbENvbnRlbnQpO1xuICAgICAgICAgICAgLy8gVXBkYXRlIGZvcm0gbW9kZWwuXG4gICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKGNvbnRlbnQpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIGlmICghdGhpcy5fJGVsZW1lbnQpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdGhpcy5fJGVsZW1lbnQub24oJ3N1bW1lcm5vdGUuaW5pdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlTW9kZWwoKTtcbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLl8kZWxlbWVudC5vbignc3VtbWVybm90ZS5jaGFuZ2UnLCBmdW5jdGlvbiAoZXZlbnQsIGNvbnRlbnRzLCAkZWRpdGFibGUpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlTW9kZWwoY29udGVudHMpO1xuICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuXyRlbGVtZW50Lm9uKCdzdW1tZXJub3RlLmJsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBzZWxmLm9uVG91Y2hlZCgpO1xuICAgICAgICAgICAgICAgIHNlbGYuYmx1ci5lbWl0KCk7XG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuaW1tZWRpYXRlQW5ndWxhck1vZGVsVXBkYXRlKSB7XG4gICAgICAgICAgICB0aGlzLl9lZGl0b3Iub24oJ2tleXVwJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZU1vZGVsKCk7XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY3JlYXRlRWRpdG9yKCkge1xuICAgICAgICBpZiAodGhpcy5fZWRpdG9ySW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0Q29udGVudCh0cnVlKTtcblxuICAgICAgICBcbiAgICAgICAgLy8gdGhpcy5pbml0TGlzdGVuZXJzKCk7IC8vIGlzc3VlICMzMSBcblxuICAgICAgICAvLyBpbml0IGVkaXRvclxuICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fZWRpdG9yID0gdGhpcy5fJGVsZW1lbnQuc3VtbWVybm90ZSh0aGlzLl9vcHRpb25zKS5kYXRhKCdzdW1tZXJub3RlJykuJG5vdGU7XG4gICAgICAgICAgICB0aGlzLmluaXRMaXN0ZW5lcnMoKTsgLy8gaXNzdWUgIzMxXG4gICAgICAgICAgICBpZiAodGhpcy5uZ3hTdW1tZXJub3RlRGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl8kZWxlbWVudC5zdW1tZXJub3RlKCdkaXNhYmxlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuX2VkaXRvckluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldEh0bWwoKSB7XG4gICAgICAgIHRoaXMuXyRlbGVtZW50LnN1bW1lcm5vdGUoJ2NvZGUnLCB0aGlzLl9tb2RlbCB8fCAnJywgdHJ1ZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRDb250ZW50KGZpcnN0VGltZSA9IGZhbHNlKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwic2V0IGNvbnRlbnRcIiwgZmlyc3RUaW1lLCB0aGlzLl9vbGRNb2RlbCwgdGhpcy5fbW9kZWwpXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICAvLyBTZXQgaW5pdGlhbCBjb250ZW50XG4gICAgICAgIGlmICh0aGlzLl9tb2RlbCB8fCB0aGlzLl9tb2RlbCA9PT0gJycpIHtcbiAgICAgICAgICAgIHRoaXMuX29sZE1vZGVsID0gdGhpcy5fbW9kZWw7XG4gICAgICAgICAgICBpZiAodGhpcy5faGFzU3BlY2lhbFRhZykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhZ3M6IE9iamVjdCA9IHRoaXMuX21vZGVsO1xuICAgICAgICAgICAgICAgIC8vIGFkZCB0YWdzIG9uIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBpZiAodGFncykge1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYXR0ciBpbiB0YWdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFncy5oYXNPd25Qcm9wZXJ0eShhdHRyKSAmJiBhdHRyICE9PSB0aGlzLklOTkVSX0hUTUxfQVRUUikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuXyRlbGVtZW50LmF0dHIoYXR0ciwgdGFnc1thdHRyXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodGFncy5oYXNPd25Qcm9wZXJ0eSh0aGlzLklOTkVSX0hUTUxfQVRUUikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuXyRlbGVtZW50WzBdLmlubmVySFRNTCA9IHRhZ3NbdGhpcy5JTk5FUl9IVE1MX0FUVFJdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZWxmLnNldEh0bWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZGVzdHJveUVkaXRvcigpIHtcbiAgICAgICAgaWYgKHRoaXMuX2VkaXRvckluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICB0aGlzLl9lZGl0b3Iub2ZmKCdrZXl1cCcpO1xuICAgICAgICAgICAgdGhpcy5fJGVsZW1lbnQuc3VtbWVybm90ZSgnZGVzdHJveScpOyAvLyBUT0RPIG5vdCBzdXJlIGl0IHdvcmtzIG5vdy4uLlxuICAgICAgICAgICAgdGhpcy5fZWRpdG9ySW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RWRpdG9yKCkge1xuICAgICAgICBpZiAodGhpcy5fJGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl8kZWxlbWVudC5zdW1tZXJub3RlLmJpbmQodGhpcy5fJGVsZW1lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8gc2VuZCBtYW51YWwgZWRpdG9yIGluaXRpYWxpemF0aW9uXG4gICAgLy8gVE9ETyBub3Qgc3VyZSBpdCB3b3JrcyBub3cuLi5cbiAgICBwcml2YXRlIGdlbmVyYXRlTWFudWFsQ29udHJvbGxlcigpIHtcbiAgICAgICAgY29uc3QgY29udHJvbHMgPSB7XG4gICAgICAgICAgICBpbml0aWFsaXplOiB0aGlzLmNyZWF0ZUVkaXRvci5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgZGVzdHJveTogdGhpcy5kZXN0cm95RWRpdG9yLmJpbmQodGhpcyksXG4gICAgICAgICAgICBnZXRFZGl0b3I6IHRoaXMuZ2V0RWRpdG9yLmJpbmQodGhpcyksXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc3VtbWVybm90ZUluaXQuZW1pdChjb250cm9scyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyB1cGxvYWRJbWFnZShmaWxlcykge1xuICAgICAgICBjb25zdCBkYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgIHRoaXMuaW1hZ2VVcGxvYWQuZW1pdCh7IHVwbG9hZGluZzogdHJ1ZSB9KTtcbiAgICAgICAgZGF0YS5hcHBlbmQoJ2ltYWdlJywgZmlsZXNbMF0pO1xuICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy51cGxvYWRJbWFnZVBhdGgpIHtcbiAgICAgICAgICAgIHRoaXMuaHR0cC5wb3N0KHRoaXMuX29wdGlvbnMudXBsb2FkSW1hZ2VQYXRoLCBkYXRhKVxuICAgICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgICAgICBtYXAoKHJlc3BvbnNlOiB7IHBhdGg6IHN0cmluZyB9KSA9PiByZXNwb25zZSAmJiB0eXBlb2YgcmVzcG9uc2UucGF0aCA9PT0gJ3N0cmluZycgJiYgcmVzcG9uc2UucGF0aCksXG4gICAgICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKCdBbiBlcnJvciBvY2N1cmVkIHdoaWxlIHVwbG9hZGluZycgKyBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZignJyk7XG4gICAgICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoZGF0YUluID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFJbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fJGVsZW1lbnQuc3VtbWVybm90ZSgnaW5zZXJ0SW1hZ2UnLCBkYXRhSW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZVVwbG9hZC5lbWl0KHsgdXBsb2FkaW5nOiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0RnJvbURhdGFVUkwoZmlsZXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnNlcnRGcm9tRGF0YVVSTChmaWxlcyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmluc2VydEZyb21EYXRhVVJMKGZpbGVzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGluc2VydEZyb21EYXRhVVJMKGZpbGVzKSB7XG4gICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGVzWzBdKTtcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuXyRlbGVtZW50LnN1bW1lcm5vdGUoJ2luc2VydEltYWdlJywgcmVhZGVyLnJlc3VsdCk7XG4gICAgICAgICAgICB0aGlzLmltYWdlVXBsb2FkLmVtaXQoeyB1cGxvYWRpbmc6IGZhbHNlLCBlbmNvZGluZzogJ2Jhc2U2NCcgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHJlYWRlci5vbmVycm9yID0gZXJyb3IgPT4gY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfVxuXG5cbiAgICBwcml2YXRlIGNvZGVCbG9ja0J1dHRvbigpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgICAgICAgICBjb25zdCB1aSA9ICQuc3VtbWVybm90ZS51aTtcbiAgICAgICAgICAgIC8vIGNyZWF0ZSBidXR0b25cbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9IHVpLmJ1dHRvbih7XG4gICAgICAgICAgICAgICAgY29udGVudHM6ICdDb2RlIGJsb2NrJyxcbiAgICAgICAgICAgICAgICB0b29sdGlwOiAnQWRkIHJhdyBjb2RlJyxcbiAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWRUZXh0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGJlbG93IGNvZGUgd2lsbCBjb3B5IHRoZSBzZWxlY3RlZCBibG9jayBhbmQgYWRkIGl0IGludG8gb3VyIGNvZGU9YmxvY2tcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkVGV4dCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKS50b1N0cmluZygpLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2RlVGV4dCA9IHNlbGVjdGVkVGV4dCA/IHNlbGVjdGVkVGV4dCA6IGBQbGFjZSB5b3VyIGNvZGUgaGVyZS5gO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2RlQmxvY2sgPSBgPHByZSBjbGFzcz1cImNvZGUtYmxvY2tcIiBzdHlsZT1cImZvbnQtZmFtaWx5OiBNZW5sbywgTW9uYWNvLCBDb25zb2xhcywgJ0NvdXJpZXIgTmV3JywgbW9ub3NwYWNlOyBmb250LXNpemU6IDEycHg7IHBhZGRpbmc6IDE0cHggMTJweDsgbWFyZ2luLWJvdHRvbTogMTBweDsgbGluZS1oZWlnaHQ6IDEuNDI4NTc7IHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsgb3ZlcmZsb3ctd3JhcDogYnJlYWstd29yZDsgYmFja2dyb3VuZC1jb2xvcjogcmdiKDI1MCwgMjUxLCAyNTMpOyBib3JkZXI6IDFweCBzb2xpZCByZ2IoMjM0LCAyMzYsIDI0MCk7IGJvcmRlci1yYWRpdXM6IDRweDsgY29sb3I6ICM2MGEwYjBcIj48c3BhbiBzdHlsZT1cIndoaXRlLXNwYWNlOiBwcmUtd3JhcDtcIj4ke2NvZGVUZXh0fTwvc3Bhbj48L3ByZT5gO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3IucGFzdGVIVE1MJywgY29kZUJsb2NrKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbi5yZW5kZXIoKTsgICAvLyByZXR1cm4gYnV0dG9uIGFzIGpxdWVyeSBvYmplY3RcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==